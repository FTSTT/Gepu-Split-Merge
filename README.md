# Gepu-Split-Merge 图片分割与合并工具
用于从扫描版歌谱或通用书籍中跨页面截取段落图片并整理的工具。
> 基于 Python + Tkinter + Pillow 的 GUI 工具  
> 方便对多张图片进行纵向预览、分割、并拼接合并，支持自动记录分割位置并根据窗口大小动态缩放。

---

## 功能简介

1. **加载多张图片**  
   - 支持一次选择多张图片 (`.jpg / .png / .jpeg / .tif / .bmp`等常见格式)。  
   - 根据图片文件名中的数字部分进行排序显示。

2. **可滚动预览**  
   - 使用 `Tkinter.Canvas` + `Scrollbar` 实现垂直滚动查看多图。  
   - 窗口大小变化时自动对所有图片等比例缩放，以适应当前界面宽度。

3. **添加分割线并合并**  
   - 在画布上点击（单击左键）可添加分割线，并询问是否立即合并当前选区。  
   - 选区基于最后两条分割线（或从顶部到单条分割线）的范围，对所有图片在该范围内的区域进行裁剪并纵向拼接为一张完整图片。  
   - 多次点击可添加多条分割线，或在“工具栏”点击“清除分割线”重置。  

4. **缩放后分割线保持正确位置**  
   - 分割线内部采用“原始累计高度坐标”进行定位。  
   - 每次重绘时，会将原坐标转换为当前画布坐标，以确保分割线在缩放后保持准确位置。

5. **合并结果输出**  
   - 默认保存为 `merged_1.png`, `merged_2.png` 等依次递增文件名。  
   - 合并完成后不弹出提示框，而是在窗口标题栏显示“图片已创建: merged_xxx.png” 等信息。

---

## 环境依赖

- **Python 3.7+**（推荐 3.9+）  
- **Pillow (PIL)** 版本 9.1 及以上，建议 10.0+  
  - 如果 Pillow 太旧，可能没有 `Image.Resampling`，请执行
    ```bash
    pip install --upgrade pillow
    ```
- **Tkinter**（Python 内置，一般无需额外安装，如遇不到可在对应系统上手动安装）

---

## 使用步骤

1. **克隆或下载本项目源码**  
   ```bash
   git clone https://github.com/FTSTT/Gepu-Split-Merge.git
   cd Gepu-Split-Merge
   ```

2. **安装依赖**  
   - 建议使用虚拟环境或 Conda：
     ```bash
     pip install --upgrade pillow
     ```
   - 确保系统已安装 Tkinter(一般 Windows 和 macOS 默认自带；Linux 可能需手动安装 `python3-tk`)

3. **运行工具**  
   ```bash
   python split7.py
   ```
   - 程序启动后，会打开一个 GUI 窗口。

4. **加载图片**  
   - 点击“加载文件”按钮，选择需要操作的图片文件们。  
   - 程序会按文件名中的数字对图片进行排序，然后在主画布区域依次显示。

5. **添加分割线**  
   - 在图像上点击左键，即可添加一条分割线。  
   - 分割线是基于整组图像的“原始高度”进行定位，窗口大小变化时它会自动调整到对应的缩放后位置。

6. **合并保存**  
   - 每次添加分割线后会询问“是否保存当前选区”。选区即最后两条分割线之间或顶部到最后一条分割线之间的纵向区域。  
   - 若点“是”，工具会裁剪所有图片在该纵向区间内的内容，并将其依次纵向拼接成一张大图，生成 `merged_1.png` / `merged_2.png` 等。  
   - 合并成功后，会在窗口标题栏显示“图片已创建: merged_1.png”等字样。

7. **清除分割线**  
   - 若需要重新设置分割线，点击“清除分割线”按钮即可一次性删除所有分割线，然后可再次添加新的分割线。

---

## 主要文件说明

- **`split7.py`**  
  - 核心逻辑代码：GUI 窗口、图片加载、图片缩放、分割线、裁剪合并逻辑等。

---

## 常见问题

1. **分割线无法准确对齐？**  
   - 确保你使用的是示例中的最新逻辑，分割线采用“原始高度”定位，并在重绘时转换到缩放后坐标。如果发现异常，请检查是否对代码做了修改。

2. **Pillow 版本过旧导致 `AttributeError: module 'PIL.Image' has no attribute 'Resampling'`？**  
   - 需要升级 `Pillow` 或改用 `Image.LANCZOS`。推荐使用最新的 Pillow 版本执行  
     ```bash
     pip install --upgrade pillow
     ```
     
3. **图片文件名不是数字开头**  
   - 示例代码里通过 `int(os.path.basename(x).split('.')[0])` 来进行排序，若文件名不符合此格式，会出错。  
   - 可以根据需要修改排序逻辑，如使用 `sorted(file_paths)` 或正则提取数字等。

---

## 许可证

本项目可自由学习与修改，MIT License 。  

---

如有任何问题或建议，欢迎在 Issues 中提出，共同完善该工具。谢谢使用！  
